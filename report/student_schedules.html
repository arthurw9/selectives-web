{% extends 'menu.html' %}
{% block session_body %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.debug.js">
// Using jsPDF. To learn more:
//   http://rawgit.com/MrRio/jsPDF/master/#
//   http://rawgit.com/MrRio/jsPDF/master/docs/jspdf.js.html#line1158
// To create a Data url from an image:
//   http://dataurl.net/#dataurlmaker
</script>
<script>
var MAX_STUDENTS_PER_PAGE = 17;
var TEXT_FONT_SIZE = 8;

window.onload = function() {
  var downloadPDF = document.getElementById("downloadPDF");

  downloadPDF.onclick = function() {
    var doc = new jsPDF();
    var totalPgCnt = 1;
    var currY = 22;
    var studentCnt = 1;
    var line0 = 0;
    var line1 = 0;
    var line2 = 0;
    var line3 = 0;
    
    doc.setFontSize(TEXT_FONT_SIZE);
    doc.text('Page ' + totalPgCnt, 180, 12)
    doc.setFontType('bold');
    line0 = currY-4;
    doc.text('Monday', 42, line0, null, null, 'center');
    doc.text('Tuesday', 84, line0, null, null, 'center');
    doc.text('Thursday', 123, line0, null, null, 'center');
    doc.text('Friday', 160, line0, null, null, 'center');
    {% for s in students %}
      doc.setLineWidth(0.1);
      doc.rect(19, currY-3, 175, 14, 2, 2);
      doc.setFillColor(250, 250, 250);
      doc.rect(19, currY-3, 80, 4, 'FD', 2, 2);
      line1 = currY;
      line2 = currY+5;
      line3 = currY+9;
      doc.setFontType('normal');
      doc.text('{{s['last']}}' + ', ' + '{{s['first']}}', 21, line1);
      doc.setFontType('bold');
      doc.text('Gr', 76, line1);
      doc.setFontType('normal');
      doc.text('{{s['current_grade']}}', 80, line1);
      doc.setFontType('bold');
      doc.text('Rm', 85, line1);
      doc.setFontType('normal');
      doc.text('{{s['current_homeroom']}}', 91, line1);
      doc.setFontType('bold');
      doc.text('A', 21, line2);
      doc.text('B', 21, line3);
      doc.setFontType('normal');
      doc.text("{{s['Mon A'] | safe}}", 30, line2);
      doc.text("{{s['Tues A'] | safe}}", 70, line2);
      doc.text("{{s['Thurs A'] | safe}}", 110, line2);
      doc.text("{{s['Fri A'] | safe}}", 150, line2);
      doc.text("{{s['Mon B'] | safe}}", 30, line3);
      doc.text("{{s['Tues B'] | safe}}", 70, line3);
      doc.text("{{s['Thurs B'] | safe}}", 110, line3);
      doc.text("{{s['Fri B'] | safe}}", 150, line3);
      currY += 15;
      studentCnt += 1;
      if (studentCnt > MAX_STUDENTS_PER_PAGE) {
        doc.addPage();
        studentCnt = 1;
        currY = 22;
        totalPgCnt += 1;
        doc.text('Page ' + totalPgCnt, 180, 12)
        doc.setFontType('bold');
        doc.text('Monday', 42, line0, null, null, 'center');
        doc.text('Tuesday', 84, line0, null, null, 'center');
        doc.text('Thursday', 123, line0, null, null, 'center');
        doc.text('Friday', 160, line0, null, null, 'center');
      }
    {% endfor %}
    doc.save('selectives_student_schedules.pdf');

    // Prevent redirect and event bubbling.
    return false;
  };
};
</script>

<h3>Student Schedules</h3>
<br>
<br>

<form>
<input type="button" id="downloadPDF" value="Download PDF">
</form>

{% endblock %}
